---
title: "Examen Final Bioinformatica"
author: "Leonardo Francisco Proaño Rhon"
date: "15/3/2022"
output: 
  html_document:
    self_contained: true
    fig_height: 6
    fight_width: 8
    theme: journal
    highlight: espresso
    toc: yes
    toc_depht: 4
    toc_float:
      collapsed: no
      smooth_scroll: yes
---
![](./data/img/ikiam.png)


## Resolución del Examen Final
### Pregunta 1: Manipulación de datos

#### 1.1. Defina su directorio de trabajo.

```{r wd, include=TRUE}

setwd("D:/Documentos/GitHub/GBI6_ExamenFinal")

```

#### 1.2. Cargue la data “mRNA_expr.csv”

```{r data}
library(readr)

df <- read_csv("./data/mRNA_expr.csv")
head(df)
```

#### 1.3.Cree una función de nombre long_df para transformar la data df de la forma wide a long.

```{r funcion_long}
# Escriba aquí la función long_df
long_df <- function(df) {
  library(tidyr)
  library(dplyr)
  df$dataset <- as.factor(df$dataset)
  df_l <- gather(df, gen, expresion_level, GATA3, PTEN, XBP1, ESR1, MUC1, FN1, GAPDH, factor_key=TRUE)
  df_l2 <- select(df_l, -bcr_patient_barcode)
  return (df_l2)
}
```



#### 1.4.Genere la data df_long utilizandola función long_df.

```{r df_long}
# Genere la data df_long 
library(dplyr)
df_long <- long_df(df)
tablaDes <- df_long %>% group_by(gen)
tablaDes
```

#### 1.5 A partir de la data df_long, genere un Descriptive table (librería sjPlot) y guárdelo en el subdirectorio “result” con el nombre mRNA_expr_summary.doc (previamente debe seleccionar las celdas adecuadas con funciones de la librería dplyr en conjunto con el operador %>%).

```{r desc_table}
# Escriba el código para crear el Descriptive table 
library(sjPlot)
library(sjmisc)
CAMama <- tablaDes %>% group_by(gen) %>% mutate(row = row_number()) %>%
  tidyr::pivot_wider(names_from = gen, values_from = expresion_level) %>%
  select(-row)
descr(CAMama) %>% tab_df(title = "Estadistica descriptiva del cáncer de MAMA y su nivel de expresion en los genes",
                             file = "D:/Documentos/GitHub/GBI6_ExamenFinal/results/mRNA_expr_summary.doc") 


```

#### 1.6 Interprete los resultados de la tabla resultante de la sección 1.5.

```{r}
# Escriba aquí su interpretación 
# Los genes con más expresión fueron ESR1 y MUC1, mientras GATA3 y XBP1
# tuvieron una menor expresión en comparación de todos los genes.
```

### Pregunta 2: Visualización de datos
#### 2.1 Cree la funcion tcga_boxplots para visualizar boxplots y jitterplots. El único parámetro de la función es dataset. La función debe crear un boxplot de los niveles de expresión para cada gen.

```{r}
# Escriba el código para crear la función tcga_boxplots
library(tidyverse)

tcga_boxplots=function(df1){
  
  
  m=df1[,c(1,2)]
  names(m)=c("fac1","ind1")
  nom=as.character(levels(m[,1]))
n=NULL

 
 for (i in 1:length(levels(m$fac1))){
   
    j=ggplot(m%>%filter(fac1==nom[i]),aes(fac1,ind1))+geom_jitter()+geom_boxplot(alpha=0.3)+xlab("Tipo de Cancer")+ylab("Gen")+
theme_bw()+theme(legend.position='none')
    n[[i]]=j

}
    
  return(n)
}
head(df_long)

```

#### 2.2 Utilizando la función lapply() genera la lista cancertype_boxplots con las gráficas para cada tipo de cancer (cada tipo de dataset).

```{r list_boxplots, eval=FALSE, message=FALSE, warning=FALSE, include=TRUE, paged.print=FALSE}

cancertype_boxplots=tcga_boxplots(df_long)



```

#### 2.3 Guarde en el subdirectorio result el tercer plot de la lista cancertype_boxplots con el nombre boxplot3.png. La definición de a figura debe ser de 300dpi.

```{r boxplot3}
# Escriba el código para guardar la tercera figura de la lista. 


```

#### 2.4 Escriba la función reg_gen_expression, con el parámetro gen. En este caso la función visualizará una gráfica de nube de puntos (geom_point) y una regresión por tipo de “dataset”. La gráfica será de comparación de gen1 con gen2; por ejemplo en el eje “x” GATA3 y en el eje “y”” FN1.

```{r reg_gen_exp}
# Escriba aquí su función reg_gen_expression

reg_gen_expression=function(df){
  pablito=combn(1:7,2)
  graf=NULL
  df=df%>%select(gen,expresion_level)
  for (i in 1:ncol(pablito)) {
    m=NULL
      x=NULL
      y=NULL
      
      m=c(pablito[,i][1],pablito[,i][2])
      
      
  nom=as.character(levels(df[,1]))
  
  x=df[which(df$gen==nom[m[1]]),][,2]
  y=df[which(df$gen==nom[m[2]]),][,2]
  dft=data.frame(x,y)
m=ggplot(data=dft,aes(x,y))+geom_point()+xlab(nom[m[1]])+ylab(nom[m[2]])
 
   graf[[i]]=m
    
  }
  
  

  return(graf)
}

```

#### 2.5. Utilizando la función lapply() genera la lista reg_genplots con las gráficas para cada par de genes posibles. Recuerde que tiene 7 tipos de genes, se debe tener todas las combinaciones posibles por pares de genes (combinatoria sin repetición).

```{r list_regplots}
# Escriba el código para generar la lista. 
reg_genplots=reg_gen_expression(df_long)
```

#### 2.6. Guarde en el subdirectorio result el onceavo plot de la lista reg_genplots con el nombre regresion11.pdf. La definición de a figura debe ser de 300dpi.

```{r reg11}
# Escriba el código para guardar el onceavo plot. 

```

#### 2.7. Interprete los resultados de las figuras boxplot3.png y regresion11.pdf.

```{tex}
# Esciba aquí su intepretación

```
